<!DOCTYPE html>
<html lang="en" xmlns:="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>

    <link href='https://fonts.googleapis.com/css?family=Duru Sans|Faster One' rel='stylesheet'>
    <Latest compiled and minified CSS -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" th:href="@{http_maxcdn.bootstrapcdn.com_bootstrap_4.5.2_css_bootstrap.css}">
    <link rel="stylesheet" type="text/css" th:href="@{test.css}">

    <!-- jQuery library -->
    <script type="text/javascript" th:src="@{jquery.min.js}"></script>
    <script type="text/javascript" th:src="@{bootstrap.bundle.js}"></script>
    <script type="text/javascript" th:src="@{d3v4.js}"></script>
    <script src="https://d3js.org/queue.v1.min.js" type="text/javascript"></script>


    <!-- Latest compiled JavaScript -->
    <script type="text/javascript" th:src="@{http_maxcdn.bootstrapcdn.com_bootstrap_4.5.2_js_bootstrap.js}"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Chord Diagram</title>
    <!-- <script type="text/javascript" src="http://fleetinbeing.net/d3/d3.layout.js"></script> -->
    <!-- This comes from here: http://fleetinbeing.net/d3e/chord.html -->
    <!-- Another example comes from here: http://exposedata.com/tutorial/chord/latest.html -->
    <style>
        svg {
            border: 1px solid gray;
        }

        .link {
            stroke: #93C464;
        }

        path {
            fill: none;
            stroke: #666;
            stroke-width: 1.5px;
        }


        marker {
            fill: #93C464;
        }

    </style>

    <meta charset="UTF-8">
    <title>Test</title>


</head>
<body>
<div id="wrapper">
    <header class="col-12 clear">
        <strong id="projectheader">videoOCR Source Code Extractor</strong>
        <div id="nav_container">
            <ul class="nav nav-tabs">
                <li class="nav-item"><a class="nav-link" th:href="@{home}">Home</a></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">OCR Extraction</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" th:href="@{video}">Choose/Manage Videos</a>
                        <a class="dropdown-item" href="#">Manage Frames</a>
                        <a class="dropdown-item" href="#">Manage HCR</a>
                        <a class="dropdown-item" href="#">Manage Mapping</a>
                    </div>
                </li>
                <li class="nav-item"><a class="nav-link" th:href="@{animation}">Path Visualization</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{visualization}">Slider Visualization</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{codeviz}" href="#">Eye Gaze Duration</a></li>
            </ul>
        </div>

    </header>
    <svg width="960" height="500"></svg>

    <script>

        var svg = d3.select("svg"),
            width = +svg.attr("width"),
            height = +svg.attr("height"),
            color = d3.scaleOrdinal(d3.schemeCategory10);

        d3.json("testcircleforce.json", function (error, data) {

            var nodes = data.nodes;
            var links = data.links;

            var tempObj = {}

            nodes.forEach(function (d, i) {
                tempObj[d.id] = i;
            })

            links.forEach(function (d) {
                d.source = tempObj[d.source];
                d.target = tempObj[d.target];
            })

            var a = nodes[0];
            var b = nodes[1];
            var c = nodes[2];


            var simulation = d3.forceSimulation(nodes)
                .force("charge", d3.forceManyBody().strength(-1000))
                .force("link", d3.forceLink(links).distance(200))
                .force("x", d3.forceX())
                .force("y", d3.forceY())
                .alphaTarget(1)
                .on("tick", ticked);


            var g = svg.append("g").attr("transform", "translate(" + width / 2 + "," + height / 2 + ")"),
                link = g.append("g").attr("stroke", "#000").attr("stroke-width", 1.5).selectAll("path"),
                node = g.append("g").attr("stroke", "#fff").attr("stroke-width", 1.5).selectAll(".node");

            var outerPath = link.append("svg:g").selectAll("path")
                .data(links)
                .enter().append("svg:path")
                .attr("class", "link")
                .attr("marker-end", "url(#outer)");

            createPathMarkers();

            restart();

            d3.timeout(function () {
                links.push({source: a, target: b}); // Add a-b.
                links.push({source: b, target: c}); // Add b-c.
                links.push({source: c, target: a}); // Add c-a.
                restart();
            }, 1000);

            d3.interval(function () {
                nodes.pop(); // Remove c.
                links.pop(); // Remove c-a.
                links.pop(); // Remove b-c.
                restart();
            }, 2000, d3.now());

            d3.interval(function () {
                nodes.push(c); // Re-add c.
                links.push({source: b, target: c}); // Re-add b-c.
                links.push({source: c, target: a}); // Re-add c-a.
                restart();
            }, 2000, d3.now() + 1000);

            function restart() {

                // Apply the general update pattern to the nodes.
                node = node.data(nodes, function (d) {
                    return d.id;
                });
                node.exit().remove();
                node = node.enter().append("circle").attr("fill", function (d) {
                    return color(d.id);
                }).attr("r", 8).merge(node);

                // Apply the general update pattern to the links.
                link = link.data(links, function (d) {
                    return d.source.id + "-" + d.target.id;
                });
                link.exit().remove();
                link = link.enter().append("path").attr("marker-end", "url(#outer)")
                    .merge(link);

                // Update and restart the simulation.
                simulation.nodes(nodes);
                simulation.force("link").links(links);
                simulation.alpha(1).restart();

            }

            function ticked() {
                node.attr("cx", function (d) {
                    return d.x;
                })
                    .attr("cy", function (d) {
                        return d.y;
                    })

                link.attr("d", function (d) {
                    var dx = d.target.x - d.source.x,
                        dy = d.target.y - d.source.y,
                        dr = Math.sqrt(dx * dx + dy * dy);
                    return "M" +
                        d.source.x + "," +
                        d.source.y + "A" +
                        dr + "," + dr + " 0 0,1 " +
                        d.target.x + "," +
                        d.target.y;
                });
            }

        });

        function createPathMarkers() {
            // build the arrow.
            svg.append("svg:defs").selectAll("marker")
                .data(["outer"])      // Different link/path types can be defined here
                .enter().append("svg:marker")    // This section adds in the arrows
                .attr("id", String)
                .attr("viewBox", "0 -5 10 10")
                .attr("refX", 20)
                .attr("refY", -1.5)
                .attr("markerWidth", 6)
                .attr("markerHeight", 6)
                .attr("orient", "auto")
                .append("svg:path")
                .attr("d", "M0,-5L10,0L0,5");

            svg.append("svg:defs").selectAll("marker")
                .data(["inner"])      // Different link/path types can be defined here
                .enter().append("svg:marker")    // This section adds in the arrows
                .attr("id", String)
                .attr("viewBox", "0 -5 10 10")
                .attr("refX", 15)
                .attr("refY", -1.5)
                .attr("markerWidth", 4)
                .attr("markerHeight", 4)
                .attr("orient", "auto")
                .append("svg:path")
                .attr("d", "M0,-5L10,0L0,5");
        }

    </script>
</div>
</body>
</html>